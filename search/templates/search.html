{% extends 'base.html' %}
{% block content %}

<!-- Navbar -->
{% include 'navbar.html' %}

<div class="container mx-auto mt-10">
    <div class="form-style bg-white p-8 shadow-lg rounded-lg max-w-3xl mx-auto"> <!-- max-w-3xl memperlebar form -->
        <form method="GET" action="{% url 'search:show_search' %}">
            {% csrf_token %}
            
            <div class="relative mt-2">
                <input id="search-input" type="text" name="nama" value="{{ request.GET.nama }}" placeholder="Masukkan nama restoran" class="p-3 w-full border rounded-md pr-10"> <!-- class p-3 untuk padding lebih besar -->
                <span id="search-icon" class="absolute inset-y-0 right-0 flex items-center pr-3 transition-opacity duration-300 cursor-pointer" style="opacity: 0; display: none;">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M16.5 10.5A6.5 6.5 0 1110 4a6.5 6.5 0 016.5 6.5z"></path>
                    </svg>
                </span>
            </div>

            <div class="mt-4 flex space-x-4 items-center"> <!-- Menambahkan flex dan space-x-4 untuk horizontal layout -->
                <!-- Dropdown jenis makanan -->
                <div class="w-1/3">
                    <label for="jenis_makanan" class="block font-medium text-gray-700">Jenis Makanan:</label>
                    <select name="jenis_makanan" class="mt-2 p-2 w-full border rounded-md">
                        <option value="any" {% if request.GET.jenis_makanan == "any" or not request.GET.jenis_makanan %}selected{% endif %}>Any</option>
                        <option value="indonesia" {% if request.GET.jenis_makanan == "indonesia" %}selected{% endif %}>Indonesia</option>
                        <option value="western" {% if request.GET.jenis_makanan == "western" %}selected{% endif %}>Western</option>
                        <option value="middle eastern" {% if request.GET.jenis_makanan == "middle eastern" %}selected{% endif %}>Middle Eastern</option>
                        <option value="japanese" {% if request.GET.jenis_makanan == "japanese" %}selected{% endif %}>Japanese</option>
                        <option value="chinese" {% if request.GET.jenis_makanan == "chinese" %}selected{% endif %}>Chinese</option>
                    </select>
                </div>

                <!-- Dropdown rating -->
                <div class="w-1/3">
                    <label for="rating" class="block font-medium text-gray-700">Rating:</label>
                    <select name="rating" class="mt-2 p-2 w-full border rounded-md">
                        <option value="any" {% if request.GET.rating == "any" or not request.GET.rating %}selected{% endif %}>Any</option>
                        <option value="0" {% if request.GET.rating == "0" %}selected{% endif %}>Bintang &lt; 1</option>
                        <option value="1" {% if request.GET.rating == "1" %}selected{% endif %}>Bintang 1-2</option>
                        <option value="2" {% if request.GET.rating == "2" %}selected{% endif %}>Bintang 2-3</option>
                        <option value="3" {% if request.GET.rating == "3" %}selected{% endif %}>Bintang 3-4</option>
                        <option value="4" {% if request.GET.rating == "4" %}selected{% endif %}>Bintang 4-5</option>
                    </select>
                </div>

                <!-- Dropdown sorting -->
                <div class="w-1/3">
                    <label for="sort_by" class="block font-medium text-gray-700">Sort By:</label>
                    <select name="sort_by" class="mt-2 p-2 w-full border rounded-md">
                        <option value="nama" {% if request.GET.sort_by == "nama" %}selected{% endif %}>Nama (A-Z)</option>
                        <option value="-nama" {% if request.GET.sort_by == "-nama" %}selected{% endif %}>Nama (Z-A)</option>
                        <option value="rating" {% if request.GET.sort_by == "rating" %}selected{% endif %}>Rating (Terendah-Tertinggi)</option>
                        <option value="-rating" {% if request.GET.sort_by == "-rating" %}selected{% endif %}>Rating (Tertinggi-Terendah)</option>
                        <option value="harga" {% if request.GET.sort_by == "harga" %}selected{% endif %}>Harga (Termurah-Termahal)</option>
                        <option value="-harga" {% if request.GET.sort_by == "-harga" %}selected{% endif %}>Harga (Termahal-Termurah)</option>
                        <option value="jarak" {% if request.GET.sort_by == "jarak" %}selected{% endif %}>Jarak (Terdekat-Terjauh)</option>
                        <option value="-jarak" {% if request.GET.sort_by == "-jarak" %}selected{% endif %}>Jarak (Terjauh-Terdekat)</option>
                    </select><br>
                </div>
            </div>

            <div class="mt-4 flex justify-center space-x-4">
                <!-- Tombol Search -->
                <button type="submit" class="bg-orange-500 text-white py-2 px-6 rounded-md shadow-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-400">Search</button>
            
                <!-- Tombol Reset -->
                <a href="{% url 'search:show_search' %}" class="bg-gray-500 text-white py-2 px-6 rounded-md shadow-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400">Reset</a>
            </div>
            
        </form>
    </div>

    

        <!-- Tampilkan hasil pencarian atau pesan default -->
    {% if request.GET.nama or request.GET.jenis_makanan or request.GET.rating %}
    <h2 class="text-center text-2xl font-bold mt-10">Hasil Pencarian</h2>
    <ul class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        {% if message %}
            <li class="col-span-full text-center text-lg text-gray-500">{{ message }}</li>
        {% elif restaurants %}
            {% for restaurant in restaurants %}
                <li>
                    {% include 'restocard.html' %}
                </li>
            {% endfor %}
        {% endif %}
    </ul>
    {% else %}
    <p class="text-center text-xl text-gray-500 mt-10">Mau makan apa hari ini?</p>
    {% endif %}

</div>

<script>
    const searchInput = document.getElementById('search-input');
    const searchIcon = document.getElementById('search-icon');

    function hideIcon() {
        searchIcon.style.opacity = '0'; // Mengubah opacity menjadi 0
        setTimeout(() => {
            searchIcon.style.display = 'none'; // Menghilangkan ikon setelah transisi
        }, 300); // Waktu yang sama dengan durasi transisi
    }

    function showIcon() {
        searchIcon.style.display = 'flex'; // Menampilkan ikon
        setTimeout(() => {
            searchIcon.style.opacity = '1'; // Mengubah opacity menjadi 1
        }, 0); // Waktu yang sama dengan durasi transisi
    }

    searchInput.addEventListener('click', hideIcon);
    searchIcon.addEventListener('click', hideIcon);

    searchInput.addEventListener('blur', function() {
        if (searchInput.value === '') {
            showIcon();
        }
    });

    searchInput.addEventListener('input', function() {
        if (searchInput.value === '') {
            showIcon();
        } else {
            hideIcon();
        }
    });
</script>

{% endblock content %}
