<form id="wishlist-form" method="POST" action="{% url 'wishlistmenu:add_to_wishlist' %}">
    {% csrf_token %}
    <div class="form-group">
        <label for="menu_name">Nama Menu</label>
        <input type="text" name="menu_name" id="menu_name" class="form-control" placeholder="Pilih Menu">
    </div>
    <div class="form-group">
        <label for="resto_name">Nama Resto</label>
        <input type="text" name="resto_name" id="resto_name" class="form-control" placeholder="Pilih Resto">
    </div>
    <button type="submit" class="btn btn-primary">Tambah Wishlist</button>
</form>

<!-- Section for displaying wishlist items -->
<div id="wishlist-items">
    {% for item in wishlist %}
    <div class="card mt-3">
        <div class="card-body">
            <h5 class="card-title">{{ item.menu_name }}</h5>
            <h6 class="card-subtitle mb-2 text-muted">{{ item.resto_name }}</h6>
            {% if item.tried %}
                <span class="badge bg-success">Sudah Dicoba</span>
            {% else %}
                <button class="btn btn-primary" onclick="markAsTried({{ item.id }})">Sudah Dicoba</button>
            {% endif %}
            <button class="btn btn-danger" onclick="deleteWishlistItem({{ item.id }})">Hapus</button>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Include AJAX scripts directly in the HTML file -->
<script>
    // AJAX untuk submit form wishlist
    document.getElementById('wishlist-form').addEventListener('submit', function(e) {
        e.preventDefault();
        var form = this;
        var formData = new FormData(form);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', form.action, true);
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        xhr.onload = function() {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                if (response.status === 'success') {
                    alert('Wishlist added successfully!');
                    // Optionally, refresh or update the wishlist
                } else {
                    alert('Error: ' + JSON.stringify(response.errors));
                }
            } else {
                alert('Failed to add wishlist.');
            }
        };
        xhr.send(new FormData(form));
    });

    // AJAX untuk mark as tried
    function markAsTried(id) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/mark-as-tried/' + id + '/', true);
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        xhr.onload = function() {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                if (response.status === 'success') {
                    alert('Menu marked as tried!');
                    // Optionally, refresh or update the wishlist
                }
            } else {
                alert('Failed to mark as tried.');
            }
        };
        xhr.send();
    }

    // AJAX untuk delete wishlist item
    function deleteWishlistItem(id) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/delete-wishlist-item/' + id + '/', true);
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        xhr.onload = function() {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                if (response.status === 'success') {
                    alert('Wishlist item deleted successfully!');
                    // Optionally, remove the card or update the wishlist
                }
            } else {
                alert('Failed to delete wishlist item.');
            }
        };
        xhr.send();
    }
</script>
